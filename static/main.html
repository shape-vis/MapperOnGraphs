<!doctype html>
<html lang="en">
<head>
	
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<link rel="stylesheet" href="static/css/style.css">

	<!-- Icon -->
	<link rel="apple-touch-icon" sizes="57x57" href="static/favicon/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="static/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="static/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="static/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="static/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="static/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="static/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="static/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="static/favicon/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="static/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="static/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="static/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="static/favicon/favicon-16x16.png">
	<link rel="manifest" href="static/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="static/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">	
	
	<title>Mapper on Graphs</title>

	<script src="https://d3js.org/d3.v4.min.js" integrity="sha384-1EOYqz4UgZkewWm70NbT1JBUXSQpOIS2AaJy6/evZH+lXOrt9ITSJbFctNeyBoIJ" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js" integrity="sha384-hX5odjoulJel81+3dsnorXlZ7kA46f8qrV+2sBCcEAXaCyEAiRusFRjaefWw2NPp" crossorigin="anonymous"></script>

	<script src="static/js/menu.js"></script>
	<script src="static/js/graph.js"></script>
	<script src="static/js/histogram.js"></script>
	<script src="static/js/draggable_box.js"></script>

</head>
<body>

	<div class="page">
		<div class="sidebar">
			<h2>Mapper on Graphs</h2>
			<form id="parameterForm">
				<div class="container" style="padding: 0;">
					  <div class="row">
						<div class="col-4" style="padding-right: 3px;">
							<label for="dataset" style="margin-top: 3px;" >Data Set</label>
						</div>
						<div class="col-8" style="padding-right: 3px;">
							<select class="form-control form-control-sm" id="dataset" name="dataset" onchange="change_dataset();"></select>
						</div>
					  </div>
					  <div class="row">
						<div class="col-4" style="padding-right: 3px;">
								<label for="datafile" style="margin-top: 3px;" >Data File</label>
						</div>
						<div class="col-8" style="padding-right: 3px;">
								<select class="form-control form-control-sm" id="datafile" name="datafile" onchange="change_datafile();"></select>
						</div>
					  </div>
					  <div class="row">
						<div class="col-4" style="padding-right: 3px;">
							<label for="filter_func" style="margin-top: 3px;" >Filter Function</label>
						</div>
						<div class="col-8" style="padding-right: 3px;">
							<select class="form-control form-control-sm" id="filter_func" name="filter_func" onchange="change_filter_func();"></select>
						</div>
					  </div>
						<div class="form-check">
						  <input class="form-check-input" type="checkbox" value="true" id="rank_filter" name="rank_filter" onchange="change_filter_func();">
						  <label class="form-check-label" for="rank_filter">
							Rank Filter Values?
						  </label>
						</div>
				</div>

				<div class="form-group">
					<label for="coverN">Cover Elements: <span id="coverN_value">2</span></label>
					<input type="range" class="custom-range" min="2" max="10" step="1" value="2" id="coverN" name="coverN"
						   onchange="change_cover(); document.getElementById('coverN_value').innerHTML = document.getElementById('coverN').value;">
				</div>

				<div class="form-group">
					<label for="coverOverlap">Cover Overlap: <span id="coverOverlap_value">0.1</span></label>
					<input type="range" class="custom-range" min="0" max="1" step="0.01" value="0.1" id="coverOverlap" name="coverOverlap"
						   onchange="change_cover(); document.getElementById('coverOverlap_value').innerHTML = document.getElementById('coverOverlap').value;">
				</div>

						<div class="form-check">
						  <input class="form-check-input" type="checkbox" value="true" id="gcc_only" name="gcc_only" onchange="change_cover();">
						  <label class="form-check-label" for="gcc_only">
							Get GCC Only?
						  </label>
						</div>

				<div class="form-group">
					<label for="mapper_node_size_filter">Mapper Node Size Filter: <span id="mapper_node_size_filter_value">0</span></label>
					<input type="range" class="custom-range" min="0" max="20" step="1" value="0" id="mapper_node_size_filter" name="mapper_node_size_filter"
						   onchange="change_cover(); document.getElementById('mapper_node_size_filter_value').innerHTML = document.getElementById('mapper_node_size_filter').value;">
				</div>

					  <div class="row">
						<div class="col-4" style="padding-right: 3px;">
							<label for="component_method" style="margin-top: 3px;" >Component Method</label>
						</div>
						<div class="col-8" style="padding-right: 3px;">
							<select class="form-control form-control-sm" id="component_method" name="component_method" onchange="change_cover();">
								<option value="connected_components" selected>Connected Components</option>
								<option value="modularity">Modularity</option>
								<option value="async_label_prop">Async Label Propagation</option>
								<option value="label_prop">Label Propagation</option>
								<option value="centrality">Centrality</option>
							</select>
						</div>
					  </div>

			</form>


			<div class="form-group">
				<input type="button" id="downloadGraph" name="downloadGraph"
					   onclick="saveJson(mog_data,'mog.json');" value="Download MOG">
			</div>

			<img src="static/img/viridis.png" width="100%" height="20">
		</div>

		<div class="page-content" id="visualization" style="white-space: nowrap;">
			  <svg height="600" width="600" style="border: thick;" id="graph_vis"></svg>
			  <svg height="600" width="600" style="border: thick;" id="mog_vis"></svg>
		</div>
	</div>
	



	<script>

		var seqColorScheme = d3.scaleSequential().interpolator(d3.interpolateViridis); // .domain([dmin,dmax])
		var catColorScheme = d3.scaleOrdinal().range(d3.schemeSet3); // .domain(graph.nodes, function(n){ return n['type']; } )
		// var catColorScheme = d3.scaleOrdinal( d3.schemeCategory20 );

		let graph_data = null;
		let graph_vis = null;
		let histo_vis = null;
		let mog_vis = null;
		let mog_data = null;

		function update_mog(){
			d3.json( "mog?" + $("#parameterForm").serialize(), function( error, data ){
				if( error ){
					console.log(error);
				}
				else{
					mog_data = data;
					console.log( data );
			        $("#mog_vis").empty();
					mog_vis = FDL_Graph_Vis("#mog_vis",data);
					mog_vis.update_node_radius( d => Math.sqrt(d.components.length) );
					mog_vis.update_node_color( d => d.max_value );
					mog_vis.update_link_width( d => Math.sqrt(d.value) );
				}
			});

		}

		function change_dataset(){
			update_datafiles();
			change_datafile();
		}

		function change_datafile(){
			load_graph( function(){
				change_filter_func();
			});
		}

		function change_filter_func() {
			d3.json( "filter_function?" + $("#parameterForm").serialize(), function( error, data ) {
				graph_vis.update_node_color(data);
				change_cover();
			});
		}

		function change_cover(){
			update_mog();
		}





		function saveText(text, filename){
		  var a = document.createElement('a');
		  a.setAttribute('href', 'data:text/plain;charset=utf-8,'+encodeURIComponent(text));
		  a.setAttribute('download', filename);
		  a.click()
		  console.log("tried to save");
		}

		function saveJson( obj, filename ){
			saveText( JSON.stringify(obj), filename );
		}


		/*
			let field = get_selected_filter_func();
			graph_vis.update_node_color( d => d[field] );

			histo_vis.set_position( 20, 20, 100, 200 );
			histo_vis.set_bar_count(8);
			histo_vis.set_field(field);
			histo_vis.update_drawing();

			update_mog();
		}*/


		function load_graph(callback){
			d3.json( "graph?" + $("#parameterForm").serialize(), function( error, data ) {
				if( error ){
					console.log(error);
				}
				else{
					graph_data = data;
					// Update VIS
			        $("#graph_vis").empty();
					graph_vis = FDL_Graph_Vis("#graph_vis",data);
					if(callback) callback();
				}
			});
		}


		function load_misc(){
			d3.json( "graph?" + $("#parameterForm").serialize(), function( error, data ) {
				if( error ){
					console.log(error);
				}
				else{
					graph_data = data;

					// Update Menu
					update_filter_functions(data.filter_functions);

					// Update VIS
			        $("#graph_vis").empty();
					graph_vis = FDL_Graph_Vis("#graph_vis",data);
					histo_vis = histogram_vis("#graph_vis",data);
					let db = DraggableBox("#graph_vis");
					db.set_constraints( 150, 200, 20, 200 );
					db.lock_x();
					db.set_position( 150, 20, 20, 100 );
/*					db.attr("fill", "black")
						.attr("stroke", "red" )
						.attr("stroke-width", 4 );*/
					//db.lock_y();
				}
			});
		}

		load_datasets(change_datafile);

</script>



</body>
</html>

